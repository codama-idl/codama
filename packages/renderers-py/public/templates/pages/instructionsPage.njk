{% extends "layout.njk" %}
{% import "macros.njk" as macros %}

{% block main %}
{{ imports }}
{% if fieldsJSON_assignment.renders.length > 0 %}
class {{instructionName | pascalCase}}Args(typing.TypedDict):
{% for field in args.renders %}
    {{field}}
{% endfor %}


layout = borsh.CStruct(
{% for field in fieldsLayout.renders %}
    {{field}},
{% endfor %}
    )

{% endif %}

class {{instructionName | pascalCase}}Accounts(typing.TypedDict):
{% for acc in accounts %}
    {{acc.name | notKeywordCase}}:Pubkey
{% endfor %}

def {{instructionName | pascalCase}}(
{% if fieldsJSON_assignment.renders.length > 0 %}
    args: {{instructionName | pascalCase}}Args,
{% endif %}
    accounts: {{instructionName | pascalCase}}Accounts,
    program_id: Pubkey = PROGRAM_ID,
    remaining_accounts: typing.Optional[typing.List[AccountMeta]] = None,
) ->Instruction:
    keys: list[AccountMeta] = [
{% for acc in accounts %}
    AccountMeta(pubkey=accounts["{{acc.name | notKeywordCase }}"], is_signer={{ 'True' if acc.isSigner else 'False' }}, is_writable={{ 'True' if acc.isWritable else 'False' }}),
{% endfor %}
    AccountMeta(pubkey=RENT, is_signer=False, is_writable=False),
    ]
    if remaining_accounts is not None:
        keys += remaining_accounts
    identifier = {{discriminator}}
{% if fieldsJSON_assignment.renders.length > 0 %}
    encoded_args = layout.build({
{% for arg in argsToLayout.renders %}
    {{arg}},
{% endfor %}
       })
{% else %}
    encoded_args = b""
{% endif %}

    data = identifier + encoded_args
    return Instruction(program_id,data,keys)

{% endblock %}
